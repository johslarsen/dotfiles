#!/bin/bash -
image=${1:?USAGE: $0 BUILD_IMAGE [...]}
args=( "${@:2}" )

IFS=$'\n' envargs=( $(env | awk '/^GTEST/{print "--env="$0}') )

mnt=/tmp/$(basename "$PWD") # compatible with CLion
docker run --rm --user=$UID -v "$PWD:$mnt" --workdir="$mnt/build" "${envargs[@]}" "$image" ctest --output-on-failure "${args[@]}"
